---
title: 'gRPC - M·ªôt C√°ch Th·ª©c Giao Ti·∫øp Hi·ªáu Qu·∫£ Gi·ªØa C√°c Service trong H·ªá Th·ªëng Microservice?'
date: '2025-04-18'
lastmod: '2024-04-18'
tags: ['Spring Boot', 'gRPC', 'Spring-Framework']
draft: false
summary: Trong b√†i vi·∫øt n√†y m√¨nh s·∫Ω c√πng c√°c b·∫°n ti·ªÉu v·ªÅ m·ªôt giao th·ª©c truy·ªÅn t·∫£i d·ªØ li·ªáu m√† c√≥ th·ªÉ c√°c b·∫°n ƒë√£ nghe r·ªìi nh∆∞ng ch∆∞a th·∫≠t s·ª± l√†m vi·ªác nhi·ªÅu ƒë√≥ l√† gRPC. M√¨nh s·∫Ω c√πng c√°c b·∫°n t√¨m hi·ªÉu t·ªïng quan v·ªÅ gRPC v√† nghi√™n c·ª©u c√°ch √°p d·ª•ng giao th·ª©c n√†y trong m·ªôt h·ªá th·ªëng microservice x√¢y d·ª±ng b·∫±ng Spring Boot s·∫Ω nh∆∞ th·∫ø n√†o?
images: ['/static/img/cover/posts/grpc-cover.png']
layout: PostLayout
---

<TOCInline toc={props.toc} asDisclosure toHeading={3} />

# ƒê·∫∑t v·∫•n ƒë·ªÅ:

<p align="center">
  <img src="/static/img/posts/grpc/image_0.png" alt="Alt text" title="image" />
</p>

- Khi l√†m vi·ªác v·ªõi c√°c h·ªá th·ªëng client-server ch√∫ng ta ƒë√£ quen v·ªõi vi·ªác truy·ªÅn t·∫£i d·ªØ li·ªáu th√¥ng qua d·∫°ng RESTful API (g·ª≠i nh·∫≠n data d∆∞·ªõi d·∫°ng JSON object). M·∫∑c d√π d·ªØ li·ªáu d·∫°ng JSON ƒë√£ r·∫•t nh·∫π ƒë·ªÉ truy·ªÅn t·∫£i nh∆∞ng ƒë·ªëi v·ªõi c√°c h·ªá th·ªëng t·∫£i cao, y√™u c·∫ßu hi·ªáu nƒÉng cao th√¨ RESTful ch∆∞a th·ª±c s·ª± t·ªëi ∆∞u, ƒë·∫∑c bi·ªát l√† khi c√°c service giao ti·∫øp v·ªõi nhau trong h·ªá th·ªëng microservice.

- V·∫≠y t·∫°i sao gRPC l·∫°i nhanh h∆°n RESTfull API? Nhanh h∆°n nh∆∞ th·∫ø n√†o? gRPC c√≥ ∆∞u ƒëi·ªÉm, nh∆∞·ª£c ƒëi·ªÉm g√¨ kh√¥ng?

=> M√¨nh s·∫Ω c√πng c√°c b·∫°n t√¨m hi·ªÉu trong b√†i vi·∫øt n√†y.

# 1 - gRPC?

### 1.1 - gRPC l√† g√¨?

<p align="center">
  <img src="/static/img/posts/grpc/image_1.png" alt="Alt text" title="image" />
</p>

> gRPC is a modern open source high performance Remote Procedure Call (RPC) framework that can run in any environment. It can efficiently connect services in and across data centers with pluggable support for load balancing, tracing, health checking and authentication.

Ngu·ªìn: [http://grpc.io/about/](http://grpc.io/about/)

=> D·ª±a v√†o ƒë·ªãnh nghƒ©a tr√™n c√≥ th·ªÉ hi·ªÉu gRPC (gRPC Remote Procedure Call) l√† m·ªôt framework RPC c√≥ th·ªÉ ch·∫°y ·ªü b·∫•t k·ª≥ m√¥i tr∆∞·ªùng n√†o (kh√¥ng ph·ª• thu·ªôc ng√¥n ng·ªØ l·∫≠p tr√¨nh, h·ªá ƒëi·ªÅu h√†nh, hay h·∫° t·∫ßng tri·ªÉn khai). S·ª≠ d·ª•ng hi·ªáu qu·∫£ trong vi·ªác gi·ªØa ti·∫øp gi·ªØa c√°c services v·ªõi nhau, trong c√°c h·ªá th·ªëng ph√¢n t√°n.

=> gRPC ƒë∆∞·ª£c nghi√™n c·ª©u, ph√°t tri·ªÉn v√† open source b·ªüi Google, s·ª≠ d·ª•ng HTTP/2 l√†m giao th·ª©c truy·ªÅn th√¥ng tin v√† Protocol Buffers (protobuf) l√†m ng√¥n ng·ªØ ƒë·ªãnh nghƒ©a d·ªØ li·ªáu.

### 1.2 - RPC (Remote Procedure Call) l√† g√¨?

<p align="center">
  <img src="/static/img/posts/grpc/image_2.png" alt="Alt text" title="image" />
</p>

- Hi·ªÉu n√¥m na th√¨ RPC m·ªôt k·ªπ thu·∫≠t gi√∫p ch√∫ng ta c√≥ th·ªÉ g·ªçi m·ªôt h√†m (ph∆∞∆°ng th·ª©c, th·ªß t·ª•c) c·ªßa ·ª©ng d·ª•ng X tr√™n server A t·ªõi m·ªôt h√†m (ph∆∞∆°ng th·ª©c, th·ªß t·ª•c) Y tr√™n server B (A, B l√† hai server ho·∫∑c ƒë∆°n gi·∫£n ch·ªâ l√† 2 m√°y t√≠nh kh√°c nhau).

### 1.3 - HTTP/2 l√† g√¨?

<p align="center">
  <img src="/static/img/posts/grpc/image_3.png" alt="Alt text" title="image" />
</p>

-> Giao th·ª©c m√† ch√∫ng ta v·∫´n s·ª≠ d·ª•ng h√†ng ng√†y l√† `HTTP` (HTTP/1.1). Tuy nhi√™n, giao th·ª©c n√†y th√¨ c√≥ m·ªôt v√†i nh∆∞·ª£c ƒëi·ªÉm:

- Giao ti·∫øp tu·∫ßn t·ª± (m·ªói request ph·∫£i ch·ªù response xong m·ªõi g·ª≠i ti·∫øp).
- Kh√¥ng c√≥ ƒëa lu·ªìng (multiplexing) ‚Äì> 1 TCP connection ch·ªâ x·ª≠ l√Ω 1 request t·∫°i m·ªôt th·ªùi ƒëi·ªÉm.
- Header d√†i v√† n·∫∑ng (kh√¥ng ƒë∆∞·ª£c t·ªëi ∆∞u n√©n l·∫°i).
- Hi·ªáu su·∫•t th·∫•p n·∫øu g·ªçi nhi·ªÅu request (v√≠ d·ª• nhi·ªÅu t·ªáp JS/CSS trong website).

-> `HTTP/2` sinh ra ƒë·ªÉ kh·∫Øc ph·ª•c c√°c nh∆∞·ª£c ƒëi·ªÉm n√†y:

<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>ƒê·∫∑c ƒëi·ªÉm</th>
      <th>HTTP/1.1</th>
      <th>HTTP/2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Multiplexing</td>
      <td>‚ùå Kh√¥ng</td>
      <td>‚úÖ C√≥ ‚Äì nhi·ªÅu request c√πng l√∫c tr√™n 1 k·∫øt n·ªëi</td>
    </tr>
    <tr>
      <td>Header Compression</td>
      <td>‚ùå Kh√¥ng</td>
      <td>‚úÖ C√≥ ‚Äì d√πng HPACK</td>
    </tr>
    <tr>
      <td>Binary Protocol</td>
      <td>‚ùå Text-based</td>
      <td>‚úÖ Binary ‚Äì nhanh v√† g·ªçn h∆°n</td>
    </tr>
    <tr>
      <td>Server Push</td>
      <td>‚ùå Kh√¥ng</td>
      <td>‚úÖ C√≥ ‚Äì server c√≥ th·ªÉ ch·ªß ƒë·ªông g·ª≠i t√†i nguy√™n</td>
    </tr>
    <tr>
      <td>Hi·ªáu su·∫•t</td>
      <td>Trung b√¨nh</td>
      <td>Cao h∆°n nhi·ªÅu trong m√¥i tr∆∞·ªùng t·∫£i l·ªõn</td>
    </tr>
  </tbody>
</table>

### 1.4 - C√°ch th·ª©c gRPC ho·∫°t ƒë·ªông?

<p align="center">
  <img src="/static/img/posts/grpc/image_4.png" alt="Alt text" title="image" />
</p>

- ƒê·ªëi v·ªõi vi·ªác call gRPC ch√∫ng ta c≈©ng chia ra l√†m client v√† server. Trong tr∆∞·ªùng h·ª£p n√†y, ·∫£nh b√™n tr√™n client l√† `OrderService` v√† server l√† `Payment Service`.

- Nh√¨n v√†o flow b√™n tr√™n c√°c b·∫°n c√≥ th·ªÉ th·∫•y c√≥ th√™m c√°c b∆∞·ªõc encode v√† decode d·ªØ li·ªáu ·ªü c·∫£ client v√† server -> v·∫≠y t·∫°i sao gRPC v·∫´n nhanh -> nguy√™n nh√¢n l√† d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c encode sang d·∫°ng nh·ªã ph√¢n (binary) -> truy·ªÅn t·∫£i th√¥ng qua HTTP/2 -> decode tr·ªü l·∫°i d·∫°ng ban ƒë·∫ßu.

### 1.4 - gRPC c√≥ nh∆∞·ª£c ƒëi·ªÉm g√¨?

- Kh√¥ng th√¢n thi·ªán v·ªõi tr√¨nh duy·ªát: gRPC s·ª≠ d·ª•ng HTTP/2 v√† Protocol Buffers (binary), n√™n tr√¨nh duy·ªát web th√¥ng th∆∞·ªùng kh√¥ng h·ªó tr·ª£ native.
- Kh√≥ debug h∆°n REST: V√¨ gRPC truy·ªÅn d·ªØ li·ªáu d·∫°ng binary, n√™n kh√≥ xem ƒë∆∞·ª£c n·ªôi dung request/response b·∫±ng c√°c c√¥ng c·ª• nh∆∞ Postman ho·∫∑c curl.
- Ph·ª• thu·ªôc v√†o file `.proto`: N·∫øu thay ƒë·ªïi c·∫•u tr√∫c API s·∫Ω y√™u c·∫ßu c·∫≠p nh·∫≠t l·∫°i file `.proto` v√† complie l·∫°i m√£ ngu·ªìn ·ªü c·∫£ client/server -> b·∫•t ti·ªán khi h·ªá th·ªëng c√≥ nhi·ªÅu client vi·∫øt b·ªüi c√°c ng√¥n ng·ªØ kh√°c nhau.

# 2. Tri·ªÉn khai gRPC trong ·ª©ng d·ª•ng Spring Boot

### 2.1 - Ch√∫ng ta s·∫Ω l√†m g√¨?

Nh∆∞ m√¨nh ƒë√£ tr√¨nh b√†y, vi·ªác giao ti·∫øp gi·ªØa c√°c service trong h·ªá th·ªëng microservices l√† m·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh cho vi·ªác s·ª≠ d·ª•ng gRPC thay v√¨ RESTful API. T·∫•t nhi√™n, kh√¥ng ph·∫£i l√∫c n√†o gi·ªØa c√°c service c≈©ng g·ªçi hay ch·ªâ g·ªçi gRPC m√† c√≤n tu·ª≥ v√†o tr∆∞·ªùng h·ª£p c·ª• th·ªÉ.

B√†i vi·∫øt h√¥m nay m√¨nh s·∫Ω c√πng c√°c b·∫°n tri·ªÉn khai gRPC cho m·ªôt m√¥ h√¨nh microservice ƒë∆°n gi·∫£n x√¢y d·ª±ng b·∫±ng Spring Boot nh∆∞ sau:

<p align="center">
  <img src="/static/img/posts/grpc/image_5.png" alt="Alt text" title="image" />
</p>

=> Gi·∫£ s·ª≠ m√¨nh ƒëang x√¢y d·ª±ng m·ªôt h·ªá th·ªëng qu·∫£n l√Ω b·ªánh nh√¢n (patient) cho b·ªánh vi·ªán X, m·ªói b·ªánh nh√¢n t·ªõi ƒëƒÉng k√Ω kh√°m s·∫Ω c·∫ßn ph·∫£i c√≥ bill ƒë·ªÉ thanh to√°n. Khi n√†y m√¨nh s·∫Ω t√°ch l√†m 2 services:

- `Patient Service` ƒë·ªÉ x·ª≠ l√Ω th√¥ng tin b·ªánh nh√¢n.
- `Billing Service` ƒë·ªÉ x·ª≠ l√Ω th√¥ng tin li√™n quan ƒë·∫øn ho√° ƒë∆°n cho b·ªánh nh√¢n.
- M·ªói b·ªánh nh√¢n c√≥ th·ªÉ c√≥ th·ªÉ c√≥ nhi·ªÅu ho√° ƒë∆°n.

<p align="center">
  <img src="/static/img/posts/grpc/image_6.png" alt="Alt text" title="image" />
</p>

L∆∞u √Ω: ƒê√¢y ch·ªâ l√† flow ƒë∆°n gi·∫£n m√¨nh l√†m ƒë·ªÉ demo vi·ªác t√≠ch h·ª£p c≈©ng nh∆∞ tri·ªÉn khai gRPC gi·ªØa c√°c service, tr√™n th·ª±c t·∫ø m√¥ h√¨nh ·ª©ng d·ª•ng c√≤n nhi·ªÅu th√†nh ph·∫ßn kh√°c nh∆∞ `API gateway`, `Load Balancer`, `Auth Service` ...

### 2.2 - C√†i ƒë·∫∑t

üëâ Cho b·∫°n n√†o mu·ªën test tr∆∞·ªõc c√≥ th·ªÉ tham kh·∫£o source code c·ªßa m√¨nh [t·∫°i ƒë√¢y](https://github.com/canhnd15/patient-management/tree/add-grpc) nha!

·ªû b√†i n√†y, ch√∫ng ta c·∫ßn 2 ·ª©ng d·ª•ng Spring Boot ƒë·ªôc l·∫≠p n√™n c√°c b·∫°n c√≥ th·ªÉ t·∫°o m·ªôt empty project b·∫±ng [InteliJ IDEA](https://www.jetbrains.com/idea/) sau ƒë√≥ t·∫°o 2 modules l√† 2 ·ª©ng d·ª•ng Spring Boot.

1. File -> New -> Project... -> Empty Project
2. Chu·ªôt ph·∫£i v√†o empty project -> New -> Module... -> Spring Boot -> T·∫°o 2 modules (`patient-service` v√† `billing-service`)

- Project: _Maven_
- Spring Boot: _3.x_
- Project Metadata: _(Packaging: jar, Java 21)_

ƒê·ªÉ tri·ªÉn khai ƒë∆∞·ª£c gRPC th√¨ c√°c b·∫°n th√™m nh·ªØng dependencies sau v√†o file `pom.xml` c·ªßa c·∫£ hai modules v·ª´a t·∫°o (c√≥ th·ªÉ tham kh·∫£o [source code](https://github.com/canhnd15/patient-management/tree/add-grpc) c·ªßa m√¨nh):

```xml
<!--GRPC -->
<dependency>
    <groupId>io.grpc</groupId>
    <artifactId>grpc-netty-shaded</artifactId>
    <version>1.69.0</version>
</dependency>
<dependency>
    <groupId>io.grpc</groupId>
    <artifactId>grpc-protobuf</artifactId>
    <version>1.69.0</version>
</dependency>
<dependency>
    <groupId>io.grpc</groupId>
    <artifactId>grpc-stub</artifactId>
    <version>1.69.0</version>
</dependency>
<dependency> <!-- necessary for Java 9+ -->
    <groupId>org.apache.tomcat</groupId>
    <artifactId>annotations-api</artifactId>
    <version>6.0.53</version>
    <scope>provided</scope>
</dependency>
<dependency>
    <groupId>com.google.protobuf</groupId>
    <artifactId>protobuf-java</artifactId>
    <version>4.29.1</version>
</dependency>
<dependency>
    <groupId>net.devh</groupId>
    <artifactId>grpc-spring-boot-starter</artifactId>
    <version>3.1.0.RELEASE</version>
</dependency>
```

Ngo√†i ra, trong ph·∫ßn c·∫•u h√¨nh build c√°c b·∫°n c≈©ng update nh∆∞ sau:

```xml
<build>
    <extensions>
        <!-- Ensure OS compatibility for protoc -->
        <extension>
            <groupId>kr.motd.maven</groupId>
            <artifactId>os-maven-plugin</artifactId>
            <version>1.7.0</version>
        </extension>
    </extensions>
    <plugins>
        <!-- Spring boot / maven  -->
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>

        <!-- PROTO -->
        <plugin>
            <groupId>org.xolstice.maven.plugins</groupId>
            <artifactId>protobuf-maven-plugin</artifactId>
            <version>0.6.1</version>
            <configuration>
                <protocArtifact>com.google.protobuf:protoc:3.25.5:exe:${os.detected.classifier}</protocArtifact>
                <pluginId>grpc-java</pluginId>
                <pluginArtifact>io.grpc:protoc-gen-grpc-java:1.68.1:exe:${os.detected.classifier}</pluginArtifact>
            </configuration>
            <executions>
                <execution>
                    <goals>
                        <goal>compile</goal>
                        <goal>compile-custom</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

=> **Billing Service (gRPC server)**

ƒê·∫ßu ti√™n, m√¨nh ƒë·ªãnh nghƒ©a file `billing-service.proto` b√™n trong th∆∞ m·ª•c `/src/main/proto` l√† protocol buffers file ƒë·ªÉ ƒë·ªãnh nghƒ©a c·∫•u tr√∫c data v√† c√°c services, c·∫•u tr√∫c file nh∆∞ sau:

```shell
syntax  = "proto3";

option java_multiple_files = true;
option java_package = "billing";

service BillingService {
  rpc CreateBillingAccount (BillingRequest) returns (BillingResponse);
  rpc GetBillingByAccountId (AccountInfoRequest) returns (BillingByAccountResponse);
}

message BillingRequest {
  string patientId = 1;
  string name = 2;
  string email = 3;
}

message BillingResponse {
  string accountId = 1;
  string status = 2;
}

message AccountInfoRequest {
  string accountCode = 1;
  int64 amount = 2;
}

message BillingByAccountResponse {
  string accountId = 1;
  string accountCode = 2;
  string accountEmail = 3;
  int64 balance = 4;
}
```

=> T·ªïng quan c√∫ ph√°p c·ªßa file `.proto` c√°c b·∫°n c√≥ th·ªÉ tham kh·∫£o.

```shell
// Declare protobuf syntax version
syntax = "proto3";

// (Optional) Package name to organize code
package your.package.name;

// (Optional) Java / Go / Python specific options
option java_package = "com.example.service";
option java_outer_classname = "YourServiceProto";

// Import other .proto files if needed
import "google/protobuf/empty.proto";

// Define your data structure (like a DTO)
message YourMessage {
  <type> <field_name> = <number>;
  // Example: string name = 1;
}

// Define request and response messages
message YourRequest {
  // fields...
}

message YourResponse {
  // fields...
}

// Define a service with RPC methods
service YourService {
  rpc YourMethodName (YourRequest) returns (YourResponse);
  // Example: rpc GetItem (ItemRequest) returns (ItemResponse);
}
```

Sau khi ƒë·ªãnh nghƒ©a file `billing-service.proto` ch√∫ng ta s·∫Ω ph·∫£i compile (s·ª≠ d·ª•ng maven) ƒë·ªÉ sinh ra c√°c file c·∫ßn thi·∫øt.

```shell
mvn clean compile
```

Complie xong s·∫Ω t·∫°o ra th∆∞ m·ª•c `/target/generated-sources/protobuf` -> c√°c b·∫°n c·∫•u h√¨nh ƒë·ªÉ IDE nh·∫≠n bi·∫øt ƒë∆∞·ª£c th∆∞ m·ª•c n√†y l√† generated-source v√† s·ª≠ d·ª•ng nh∆∞ sau:

-> Chu·ªôt ph·∫£i -> Mark Direcoty as -> Generated Sources root

<p align="center">
  <img src="/static/img/posts/grpc/image_7.png" alt="Alt text" title="image" />
</p>

B√¢y gi·ªù m√¨nh vi·∫øt class `BillingGrpcService` ƒë·ªÉ handle c√°c logic t·ª´ ph√≠a client g·ª≠i sang. ·ªû ƒë√¢y, ƒë∆°n gi·∫£n l√† nh·∫≠n th√¥ng tin -> x·ª≠ l√Ω logic -> save v√†o DB -> tr·∫£ v·ªÅ k·∫øt qu·∫£ (b∆∞·ªõc nh·∫≠n, tr·∫£ k·∫øt qu·∫£ l√† s·ª≠ d·ª•ng gRPC).

```java
@GrpcService
public class BillingGrpcService extends BillingServiceGrpc.BillingServiceImplBase {
    private static final Logger log = LoggerFactory.getLogger(BillingGrpcService.class);
    private final BillingService billingService;

    public BillingGrpcService(BillingService billingService) {
        this.billingService = billingService;
    }

    @Override
    public void createBillingAccount(BillingRequest billingRequest,
                                     StreamObserver<BillingResponse> responseObserver) {

        log.info("createBillingAccount request: {}", billingRequest.toString());

        BillingAccountReq req = BillingAccountReq.builder()
                .patientId(UUID.fromString(billingRequest.getPatientId()))
                .title(billingRequest.getName())
                .email(billingRequest.getEmail())
                .build();
        Billing savedBill = billingService.createBillingAccount(req);

        BillingResponse response = BillingResponse.newBuilder()
                .setAccountId(String.valueOf(savedBill.getId()))
                .setStatus(savedBill.getStatus())
                .build();

        responseObserver.onNext(response);
        responseObserver.onCompleted();
    }
}
```

M√¨nh c·∫•u h√¨nh (file `application.properties`) ƒë·ªÉ:

- `billing-service` ch·∫°y tr√™n port `4001`
- gRPC server ch·∫°y tr√™n port `9001`

<p align="center">
  <img src="/static/img/posts/grpc/image_8.png" alt="Alt text" title="image" />
</p>

=> **Patient Service (gRPC client)**

T∆∞∆°ng t·ª± nh∆∞ ph√≠a server m√¨nh c≈©ng ƒë·ªãnh nghƒ©a file `billing-service.proto` ·ªü ph√≠a client l√† `patient-service` (`/src/main/proto`).

```shell
mvn clean compile
```

T·∫°o class `BillingServiceGrpcClient` ƒë·ªÉ g·ª≠i request t·ªõi gRPC server (`billing-service`). ·ªû ƒë√¢y, m√¨nh c·∫•u h√¨nh tr·ªè ƒë·∫øn `localhost:9001` nh∆∞ b√™n d∆∞·ªõi.

ƒê·ªÉ d·ªÖ h√¨nh dung, ph∆∞∆°ng th·ª©c `blockingStub.createBillingAccount(request)` ch√≠nh l√† m·ªôt thao t√°c g·ªçi h√†m t·ª´ xa (remote protocol call) thay v√¨ ch√∫ng ta hay g·ªçi http request nh∆∞ b√¨nh th∆∞·ªùng.

```java
@Service
public class BillingServiceGrpcClient {
    private static final Logger log = LoggerFactory.getLogger(BillingServiceGrpcClient.class);
    private final BillingServiceGrpc.BillingServiceBlockingStub blockingStub;

    public BillingServiceGrpcClient(
            @Value("${billing.service.address:localhost}") String serverAddress,
            @Value("${billing.service.grpc.port:9001}") int serverPort
    ) {
        log.info("Connecting to Billing Service via GRPC at {}:{}", serverAddress, serverPort);

        ManagedChannel channel = ManagedChannelBuilder.forAddress(serverAddress, serverPort)
                .usePlaintext().build();

        blockingStub = BillingServiceGrpc.newBlockingStub(channel);
    }

    public BillingResponse createBillingAccount(String patientId, String name, String email) {
        BillingRequest request = BillingRequest.newBuilder()
                .setPatientId(patientId)
                .setName(name)
                .setEmail(email)
                .build();

        BillingResponse response = blockingStub.createBillingAccount(request);
        log.info("Received response from billing service via GRPC: {}", response);
        return response;
    }
}
```

M√¨nh c·∫•u h√¨nh (file application.properties) ƒë·ªÉ:

- `patient-service` ch·∫°y tr√™n port `4000`

=> T√≥m l·∫°i, ƒë·ªÉ tri·ªÉn khai gRPC n√≥i chung v√† trong ·ª©ng d·ª•ng Spring Boot n√≥i ri√™ng ch√∫ng ta s·∫Ω ph·∫£i ƒë·ªãnh nghƒ©a c√°c file `.proto` c·∫£ ·ªü client v√† server. Sau ƒë√≥, implement logic ·ªü server c≈©ng nh∆∞ l·ªùi g·ªçi h√†m ·ªü client ƒë·ªÉ th·ª±c hi·ªán truy·ªÅn t·∫£i data.

C·ª• th·ªÉ h∆°n v·ªÅ c√°c logic code kh√°c, c√°c b·∫°n c√≥ th·ªÉ tham kh·∫£o ·ªü [source code](https://github.com/canhnd15/patient-management/tree/add-grpc) c·ªßa m√¨nh.

### 2.3 - Test

=> ƒê·ªÉ test th√¨ c√°c b·∫°n complie c·∫£ hai services v√† ch·∫°y ƒë·ªôc l·∫≠p (ch·∫°y b·∫±ng IDE ho·∫∑c file `.jar`) ƒë·ªÅu ƒë∆∞·ª£c.

·ªû ƒë√¢y, m√¨nh ƒë√£ t·∫°o m·ªôt file `create-patient.http` ƒë·ªÉ m√¥ ph·ªèng ƒë·∫ßu API t·∫°o th√¥ng tin Patient nh∆∞ sau:

```http
POST http://localhost:4000/api/patients
Content-Type: application/json

{
  "name": "John Doe1",
  "email": "john.doe1@example.com",
  "address": "123 main street22",
  "dateOfBirth": "1995-09-09",
  "registeredDate": "2024-11-28"
}
```

-> Ki·ªÉm tra log ·ªü c·∫£ hai service:

- Tr√™n `billing-service`:

```logs
2025-04-20T10:36:16.016+07:00  INFO 61970 --- [billing-service] [ault-executor-0] c.d.b.grpc.BillingGrpcService            : createBillingAccount request: patientId: "b19662fd-1245-47f2-a67b-726de38f86e6"
name: "John Doe"
email: "john.doe1@example.com"
```

- Tr√™n `patient-service`:

```logs
2025-04-20T10:36:16.128+07:00  INFO 62503 --- [patient-service] [nio-4000-exec-1] c.d.p.grpc.BillingServiceGrpcClient      : Received response from billing service via GRPC: accountId: "f0808c4e-548a-41be-9256-ce7b41ff1916"
status: "STARTED"
```

-> Nh∆∞ v·∫≠y l√† m√¨nh ƒë√£ t·∫°o th√†nh c√¥ng th√¥ng tin billing khi c√≥ request t·∫°o th√¥ng tin patient s·ª≠ d·ª•ng gRPC protocol.

# 3. T·ªïng K·∫øt

V·∫≠y l√† trong b√†i vi·∫øt n√†y m√¨nh ƒë√£ c√πng c√°c b·∫°n t√¨m hi·ªÉu v·ªÅ gRPC ‚Äì m·ªôt giao th·ª©c hi·ªán ƒë·∫°i, hi·ªáu su·∫•t cao d√†nh cho c√°c h·ªá th·ªëng ph√¢n t√°n. gRPC gi√∫p vi·ªác giao ti·∫øp gi·ªØa c√°c microservices tr·ªü n√™n nhanh ch√≥ng, t·ªëi ∆∞u v√† c√≥ c·∫•u tr√∫c r√µ r√†ng nh·ªù s·ª≠ d·ª•ng Protocol Buffers v√† HTTP/2.

·ªû c√°c b√†i vi·∫øt ti·∫øp theo m√¨nh s·∫Ω c√πng c√°c b·∫°n tri·ªÉn khai nhi·ªÅu v√≠ d·ª• ph·ª©c h∆°n li√™n quan ƒë·∫øn giao th·ª©c n√†y.

H·∫πn g·∫∑p l·∫°i c√°c b·∫°n trong c√°c b√†i vi·∫øt ti·∫øp theo. Happy Coding!
